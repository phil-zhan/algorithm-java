# <font color="red">**bfprt算法**</font>

### bfprt算法是什么？
```text
在无序数组中求第K小的数

1）改写快排的方法【荷兰国旗问题改写】
    1）随机选一个p。对数组分区。小于 P 的放在左边，等于P的放在中间，大于P的放在右边
    2）如果要求的第 k 在等于区域，直接返回
    3）如果要求的第 k 在小于区域，对左边递归
    4）如果要求的第 k 在大于区域，对右边递归
    时间复杂度O(N)



2）bfprt算法
    1）特别讲究的选一个p。对数组分区。小于 P 的放在左边，等于P的放在中间，大于P的放在右边
        每五个数划分为一个小组，最后一组可以不足五个。
        对每个小组排序【不要求整体有序】 O(N)
        将每组的中位数拿出来，组成一个新的数组M[] 【最后一组如果是偶数个，不要求中间两个的平均数，而是拿上中位数】
        求出新数组M[]的中位数【该数就是我们要选的P】
        
        第一次是五个分组【N/5组】，第二次是求中位数的中位数
        【N/5个中求一个，也就是在当前数组中的数，回到原数组中，又有两个比他大的】
        在M[]数组中，共有N/5个，大于p的有 N/10。由此可知，原数组中大于 P的有 3N/10个【M[]中的数在原数组中都有两个其对应的数大】
        为什么要5个一组？？3个、7个、9个一组，都可以收敛到 O(N)??答案是：该算法是五个人发明的，人家乐意
    2）如果要求的第 k 在等于区域，直接返回
    3）如果要求的第 k 在小于区域，对左边递归
    4）如果要求的第 k 在大于区域，对右边递归
    
    时间复杂度O(N) = O(7N/10) + O(N/5) + O(N)【也就是O(N)】
    
```

### bfprt算法核心

### 题目一
**【Code02】**
```text
给定一个无序数组arr中，长度为N，给定一个正数k，返回top k个最大的数

不同时间复杂度三个方法：

1）O(N*logN) 【从右到左，快速排序，拍完后取出第K个】

2）O(N + K*logN)【利用小跟堆。建立小跟堆是N，每次弹出一个是logN，一共弹出K次，也就是 N + K*logN】

3）O(N + K*logK)【也就是前面改写快排的方法】【K*logK ： 针对 K 长度的数组排序】
```





### 题目二
**【Code03】**
```text
蓄水池算法


解决的问题：

假设有一个源源吐出不同球的机器，

只有装下10个球的袋子，每一个吐出的球，要么放入袋子，要么永远扔掉

如何做到机器吐出每一个球之后，所有吐出的球都等概率被放进袋子里

```


```text
游戏抽奖池

需要统计一段时间内登录的所有用户，抽出100位中奖人员。也就是每个用户以 100/n 的概率中奖。
如果到最后时间点再考虑统计。可能会因为数据量过大，无法短时间计算出来。

解决办法是利用蓄水池问题。每个用户上线后，记住当前用户是第多少位上线的玩家【假设是第 i 位】。
设置一个奖池【大小为100的数组】
然后在 [1,i] 的区间上等概率随件选择一个位置，如果该位置在[0,100]的区间上，就放进奖池[覆盖奖池内的已有位置]，否则就丢弃 
到最后时间点的时候。每个用户中奖的概率就是 100/n
```



```text
设计一个生成uuid的系统
保证每个生成的uuid都不一样
吞吐量都非常大。【也就是不能一次性生成，计算量太大】

设计方式

给出所有 uuid 。
完全不用hash算法，hash也会有重复
所有uuid从一个机器发出器【利用主从集群，保证可用性】
该集群上只维护一个数据，当前给了多少号 【base】，long 类型

设计二级服务器【国家级】
当二级服务器被要求提供 UUID 的时候，
他就会向总服务器发出申请，总服务器向其返回 base 是多少，以及对应的要生成的uuid的范围段。
【如果二级服务器要求很频繁，可以调大个数段，要求不平凡，可以缩小个数段】

这样一来，二级服务器拿到base和范围段。也就可以在规定的范围段向三级服务器分发范围段。三级也可以向四级、四级向五级分发。。。。
越往上，服务器个数越少，但是压力也会越小。
所有的压力都被range化解调


好处是：任何一台服务器挂掉，不用维持数据，在其上线的时候，向其上级要新的起点和范围段就可以了。【挂掉的服务器没被用掉的uuid就直接扔掉了】
每一个父级或祖级服务器，如果并发的概率大，就将给下级的范围段调大。保证交互次数减少
当然，父级或祖级服务器也可以做自己的丛机，保证丢弃的 uuid 减少
```
